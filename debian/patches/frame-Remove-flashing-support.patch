From: =?utf-8?q?Florian_M=C3=BCllner?= <fmuellner@gnome.org>
Date: Wed, 6 Mar 2019 23:56:33 +0100
Subject: frame: Remove flashing support

It's now unused.

https://gitlab.gnome.org/GNOME/mutter/issues/491

Origin: upstream, commit:bd33e7b0027f51307657938db3b4cc1a8d03dde
Applied-Upstream: 3.32.1
---
 src/core/bell.c   | 16 ----------------
 src/core/bell.h   | 11 -----------
 src/core/frame.c  |  6 ------
 src/core/frame.h  |  1 -
 src/meta/common.h |  8 +++-----
 src/ui/theme.c    |  2 --
 6 files changed, 3 insertions(+), 41 deletions(-)

diff --git a/src/core/bell.c b/src/core/bell.c
index aa334d6..d7000b2 100644
--- a/src/core/bell.c
+++ b/src/core/bell.c
@@ -207,19 +207,3 @@ meta_bell_notify (MetaDisplay *display,
 
   return TRUE;
 }
-
-/**
- * meta_bell_notify_frame_destroy:
- * @frame: The frame which is being destroyed
- *
- * Deals with a frame being destroyed. This is important because if we're
- * using a visual bell, we might be flashing the edges of the frame, and
- * so we'd have a timeout function waiting ready to un-flash them. If the
- * frame's going away, we can tell the timeout not to bother.
- */
-void
-meta_bell_notify_frame_destroy (MetaFrame *frame)
-{
-  if (frame->is_flashing)
-    g_source_remove_by_funcs_user_data (&g_timeout_funcs, frame);
-}
diff --git a/src/core/bell.h b/src/core/bell.h
index 9205b08..f86cbb7 100644
--- a/src/core/bell.h
+++ b/src/core/bell.h
@@ -41,14 +41,3 @@ MetaBell * meta_bell_new (MetaDisplay *display);
  */
 gboolean meta_bell_notify (MetaDisplay *display,
                            MetaWindow  *window);
-
-/**
- * meta_bell_notify_frame_destroy:
- * @frame: The frame which is being destroyed
- *
- * Deals with a frame being destroyed. This is important because if we're
- * using a visual bell, we might be flashing the edges of the frame, and
- * so we'd have a timeout function waiting ready to un-flash them. If the
- * frame's going away, we can tell the timeout not to bother.
- */
-void meta_bell_notify_frame_destroy (MetaFrame *frame);
diff --git a/src/core/frame.c b/src/core/frame.c
index 7eea0a3..7699461 100644
--- a/src/core/frame.c
+++ b/src/core/frame.c
@@ -60,7 +60,6 @@ meta_window_ensure_frame (MetaWindow *window)
   frame->right_width = 0;
   frame->current_cursor = 0;
 
-  frame->is_flashing = FALSE;
   frame->borders_cached = FALSE;
 
   meta_verbose ("Frame geometry %d,%d  %dx%d\n",
@@ -177,8 +176,6 @@ meta_window_destroy_frame (MetaWindow *window)
 
   meta_frame_calc_borders (frame, &borders);
 
-  meta_bell_notify_frame_destroy (frame);
-
   /* Unparent the client window; it may be destroyed,
    * thus the error trap.
    */
@@ -298,9 +295,6 @@ meta_frame_get_flags (MetaFrame *frame)
   if (frame->window->fullscreen)
     flags |= META_FRAME_FULLSCREEN;
 
-  if (frame->is_flashing)
-    flags |= META_FRAME_IS_FLASHING;
-
   if (frame->window->wm_state_above)
     flags |= META_FRAME_ABOVE;
 
diff --git a/src/core/frame.h b/src/core/frame.h
index 73a7b4b..c0bacbe 100644
--- a/src/core/frame.h
+++ b/src/core/frame.h
@@ -49,7 +49,6 @@ struct _MetaFrame
   int bottom_height;
 
   guint need_reapply_frame_shape : 1;
-  guint is_flashing : 1; /* used by the visual bell flash */
   guint borders_cached : 1;
 
   MetaUIFrame *ui_frame;
diff --git a/src/meta/common.h b/src/meta/common.h
index 02e2802..670097b 100644
--- a/src/meta/common.h
+++ b/src/meta/common.h
@@ -63,7 +63,6 @@
  * @META_FRAME_ALLOWS_SHADE: frame allows shade
  * @META_FRAME_ALLOWS_MOVE: frame allows move
  * @META_FRAME_FULLSCREEN: frame allows fullscreen
- * @META_FRAME_IS_FLASHING: frame is flashing
  * @META_FRAME_ABOVE: frame is above
  * @META_FRAME_TILED_LEFT: frame is tiled to the left
  * @META_FRAME_TILED_RIGHT: frame is tiled to the right
@@ -83,10 +82,9 @@ typedef enum
   META_FRAME_ALLOWS_SHADE             = 1 << 10,
   META_FRAME_ALLOWS_MOVE              = 1 << 11,
   META_FRAME_FULLSCREEN               = 1 << 12,
-  META_FRAME_IS_FLASHING              = 1 << 13,
-  META_FRAME_ABOVE                    = 1 << 14,
-  META_FRAME_TILED_LEFT               = 1 << 15,
-  META_FRAME_TILED_RIGHT              = 1 << 16
+  META_FRAME_ABOVE                    = 1 << 13,
+  META_FRAME_TILED_LEFT               = 1 << 14,
+  META_FRAME_TILED_RIGHT              = 1 << 15
 } MetaFrameFlags;
 
 /**
diff --git a/src/ui/theme.c b/src/ui/theme.c
index 53d7ef5..b7618d9 100644
--- a/src/ui/theme.c
+++ b/src/ui/theme.c
@@ -1186,8 +1186,6 @@ meta_style_info_set_flags (MetaStyleInfo  *style_info,
   int i;
 
   backdrop = !(flags & META_FRAME_HAS_FOCUS);
-  if (flags & META_FRAME_IS_FLASHING)
-    backdrop = !backdrop;
 
   if (flags & META_FRAME_MAXIMIZED)
     class_name = "maximized";
